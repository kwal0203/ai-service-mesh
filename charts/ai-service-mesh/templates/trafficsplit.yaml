{{- if .Values.trafficSplit.enabled }}
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: {{ include "ai-service-mesh.fullname" . }}-{{ .Values.trafficSplit.service }}
  {{- if .Values.namespace }}
  namespace: {{ .Values.namespace }}
  {{- end }}
  labels:
    {{- include "ai-service-mesh.labels" . | nindent 4 }}
    app.kubernetes.io/component: {{ .Values.trafficSplit.service }}
spec:
  parentRefs:
    - name: {{ include "ai-service-mesh.fullname" . }}-{{ .Values.trafficSplit.service }}
      kind: Service
      group: ""
  rules:
    - backendRefs:
        {{- range .Values.trafficSplit.backends }}
        - name: {{ include "ai-service-mesh.fullname" $ }}-{{ .serviceSuffix }}
          port: {{ default $.Values.trafficSplit.port .port }}
          weight: {{ .weight }}
        {{- end }}
{{- end }}
